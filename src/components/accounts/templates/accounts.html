<div class="accounts pagepanel">
  <section ng-show="loading" class="loading"></section>
  <section ng-show="!loading">
    <h1>
      {{ 'ACCOUNTS.TITLE' | translate }}
      <span ng-show="accounts.length">({{ accounts.length }})</span>
    </h1>
    <div ng-repeat="portfolio in portfolios" class="portfolio">
      <h2>
        {{ portfolio.label }}
        <span ng-show="portfolio.accounts.length">({{ portfolio.accounts.length }})</span>
        <a class="mainbutton button" ng-click="promptForm({ portfolioid: portfolio.id })">{{ 'ACCOUNTS.ADD_ACCOUNT_IN_PORTFOLIO' | translate }}</a>
      </h2>

      <div ng-show="portfolio.accounts.length == 0" class="muted">
        {{ 'ACCOUNTS.NO_ACCOUNTS_IN_PORTFOLIO' | translate }}
      </div>
      <section ng-repeat="account in portfolio.accounts" class="account dflex">
        <div class="account-title">
          <div class="account-label">
            {{ account.label }}
            <br>
            <a ng-click="promptForm({ portfolioid: portfolio.id, id: account.id, label: account.label, publickey: account.publickey, typeid: account.typeid })" class="small-link">edit</a>
            <a ng-click="promptDelete(portfolio.id, account.id)" class="small-link">delete</a>
            <!--<a ng-click="promptMove(portfolios, account, portfolio.id)" class="small-link">move</a>-->
          </div>
          <div class="account-balance">
            {{ ::value.display(account.value) }}
          </div>
        </div>

        <div class="account-assets-setup" ng-if="!account.balances.length && account.initialized === false">
          <span>{{ 'ACCOUNTS.SETUP' | translate }}</span>
        </div>
        <div class="account-assets-setup" ng-if="!account.balances.length && account.initialized !== false">
          <span>{{ 'ACCOUNTS.EMPTY' | translate }}</span>
        </div>
        <!-- 1st case : more than 4 assets -->
        <div class="account-assets dflex" ng-if="account.balances.length && account.assets.length > 4" ng-init="account.maxdisplay = 3">
          <div class="account-asset" ng-repeat="asset in account.assets" ng-show="$index < account.maxdisplay">
            <div ng-style="{ opacity: asset.value > 0 ? 1 : 0.5 }">
              <div class="asset-image">
                <img check-src="{{ 'img/' + asset.symbol + '.svg' }}" fallback-src="img/coin.svg"/>
              </div>
              <span strvalue="asset"></span>
            </div>
          </div>
          <div class="account-asset cpointer" ng-click="account.maxdisplay = 9999" ng-hide="account.maxdisplay == 9999">
            <a class="small-link">{{ 'PORTFOLIOS.MORE_ASSETS' | translate:{ n: account.assets.length - 3 } }}</a>
          </div>
          <div class="account-asset" ng-if="account.maxdisplay == 9999 && account.assets.length % 4 == 3"></div>
          <div class="account-asset" ng-if="account.maxdisplay == 9999 && account.assets.length % 4 == 2"></div>
          <div class="account-asset" ng-if="account.maxdisplay == 9999 && account.assets.length % 4 == 2"></div>
          <div class="account-asset" ng-if="account.maxdisplay == 9999 && account.assets.length % 4 == 1"></div>
          <div class="account-asset" ng-if="account.maxdisplay == 9999 && account.assets.length % 4 == 1"></div>
          <div class="account-asset" ng-if="account.maxdisplay == 9999 && account.assets.length % 4 == 1"></div>
        </div>
        <!-- 2nd case : at most 4 assets -->
        <div class="account-assets" ng-if="account.balances.length && account.assets.length <= 4">
          <div class="account-asset" ng-repeat="asset in account.assets">
            <div ng-style="{ opacity: asset.value > 0 ? 1 : 0.5 }">
              <div class="asset-image">
                <img check-src="{{ 'img/' + asset.symbol + '.svg' }}" fallback-src="img/coin.svg"/>
              </div>
              <span strvalue="asset"></span>
            </div>
          </div>
          <div class="account-asset" ng-if="account.assets.length < 4"></div>
          <div class="account-asset" ng-if="account.assets.length < 3"></div>
          <div class="account-asset" ng-if="account.assets.length < 2"></div>
        </div>
      </div>

    </div>
  </section>
</div>
